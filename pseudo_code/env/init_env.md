# init_env.c 疑似コード

## 関数: update_shlvl
- **引数**:
  - `env`: 環境変数リストへのポインタ
- **処理**:
  1. リストを走査して "SHLVL" を探す。
  2. 見つかった場合:
     - 現在の値を整数に変換し、1を加算する。
     - 古い値を解放し、新しい値を文字列として設定する。
     - 終了する。
  3. 見つからなかった場合:
     - "SHLVL=1" を新しいノードとしてリストに追加する。

## 関数: ensure_pwd
- **引数**:
  - `env`: 環境変数リストへのポインタ
- **処理**:
  1. リストを走査して "PWD" を探す。
  2. 見つかった場合、終了する。
  3. 見つからなかった場合:
     - `getcwd` で現在の作業ディレクトリを取得する。
     - 取得できた場合、"PWD" としてリストに追加する。
     - 取得したパスのメモリを解放する。

## 関数: ensure_underscore
- **引数**:
  - `env`: 環境変数リストへのポインタ
- **処理**:
  1. リストを走査して "_" を探す。
  2. 見つかった場合、終了する。
  3. 見つからなかった場合:
     - "_=/usr/bin/env" を新しいノードとしてリストに追加する。

## 関数: process_env_entry
- **引数**:
  - `env`: 環境変数リストへのポインタ
  - `entry`: 環境変数の文字列 ("KEY=VALUE")
- **処理**:
  1. 文字列内に `=` が含まれるか確認する。
  2. `=` が存在する場合:
     - `=` の前までを `key` として抽出する。
     - `=` の後を `value` として複製する。
     - `key` と `value` が正常に作成された場合、`new_env_node` でノードを作成し、`add_env_node` でリストに追加する。
     - `key` と `value` の一時メモリを解放する。

## 関数: init_env
- **引数**:
  - `envp`: 環境変数の文字列配列
- **戻り値**:
  - 環境変数リスト
- **処理**:
  1. 環境変数リスト `env` を `NULL` に初期化する。
  2. `envp` の各要素についてループする:
     - `process_env_entry` を呼び出し、環境変数をリストに追加する。
  3. `ensure_pwd` を呼び出し、PWD がなければ追加する。
  4. `update_shlvl` を呼び出し、SHLVL を更新または追加する。
  5. `ensure_underscore` を呼び出し、_ がなければ追加する。
  6. 作成されたリスト `env` を返す。
