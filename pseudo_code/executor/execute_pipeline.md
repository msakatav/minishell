# execute_pipeline.c 疑似コード

## 関数: count_cmds
- **引数**:
  - `cmds`: コマンドリスト
- **処理**:
  1. リスト内のコマンド数をカウントして返す。

## 関数: execute_child
- **引数**:
  - `cmd`: 現在のコマンド
  - `data`: シェルの主要データ構造体
  - `prev_pipe`: 前のパイプのファイルディスクリプタ配列
  - `pipe_fd`: 現在のパイプのファイルディスクリプタ配列
- **処理**:
  1. 前のパイプが存在する場合 (`prev_pipe[0] != -1`):
     - `dup2` で `prev_pipe[0]` を標準入力 (`STDIN_FILENO`) に複製する。
     - `prev_pipe` の両端を閉じる。
  2. 次のコマンドが存在する場合 (`cmd->next`):
     - `pipe_fd[0]` (読み込み側) を閉じる。
     - `dup2` で `pipe_fd[1]` を標準出力 (`STDOUT_FILENO`) に複製する。
     - `pipe_fd[1]` (書き込み側) を閉じる。
  3. `setup_redirections` を呼び出し、リダイレクトを設定する。
     - 失敗した場合、ステータス `1` で終了 (`exit`) する。
  4. コマンドがビルトインの場合:
     - `execute_builtin` を呼び出し、その戻り値で終了 (`exit`) する。
  5. 外部コマンドの場合:
     - `find_executable` でパスを検索する。
     - パスが見つからない場合、エラーを出力し `127` で終了する。
     - 実行権限がない場合、エラーを出力し `126` で終了する。
     - `env_to_array` で環境変数を変換する。
     - `execve` でコマンドを実行する。
     - 失敗した場合、`126` で終了する。

## 関数: execute_pipeline
- **引数**:
  - `cmds`: コマンドリスト
  - `data`: シェルの主要データ構造体
- **処理**:
  1. `prev_pipe` を `-1` で初期化する。
  2. コマンド数をカウントする。
  3. コマンドリストを走査するループ:
     - 次のコマンドがある場合、`pipe` を作成する。失敗したらエラーを出力して終了。
     - `fork` で子プロセスを作成する。
     - 子プロセスの場合:
       - `execute_child` を呼び出し、コマンドを実行する。
     - 親プロセスの場合:
       - `last_pid` を更新する。
       - 前のパイプ (`prev_pipe`) が開いていれば閉じる。
       - 次のコマンドがある場合、現在のパイプ (`pipe_fd`) を `prev_pipe` に保存する。
     - 次のコマンドへ進む。
  4. ループ終了後、残っている `prev_pipe` を閉じる。
  5. すべての子プロセスを待機するループ (`cmd_count` 回):
     - `wait` で終了を待つ。
     - 終了したプロセスが最後のコマンド (`last_pid`) の場合、その終了ステータスを `data->exit_status` に保存する。
