# execute_pipeline.c 疑似コード

## 関数: execute_child
- **引数**:
  - `cmd`: 現在のコマンド
  - `data`: シェルの主要データ構造体
  - `prev`: 前のパイプのファイルディスクリプタ配列
  - `pfd`: 現在のパイプのファイルディスクリプタ配列
- **処理**:
  1. 前のパイプが存在する場合 (`prev[0] != -1`):
     - `dup2` で `prev[0]` を標準入力 (`STDIN_FILENO`) に複製する。
     - `prev` の両端を閉じる。
  2. 次のコマンドが存在する場合 (`cmd->next`):
     - `pfd[0]` (読み込み側) を閉じる。
     - `dup2` で `pfd[1]` を標準出力 (`STDOUT_FILENO`) に複製する。
     - `pfd[1]` (書き込み側) を閉じる。
  3. `setup_redirections` を呼び出し、リダイレクトを設定する。
     - 失敗した場合、ステータス `1` で終了 (`exit`) する。
  4. コマンドがビルトインの場合:
     - `execute_builtin` を呼び出し、その戻り値で終了 (`exit`) する。
  5. 外部コマンドの場合:
     - `exec_external_in_child` を呼び出し、外部コマンドを実行する。

## 関数: process_pipeline_cmd
- **引数**:
  - `cmd`: 現在のコマンド
  - `data`: シェルの主要データ構造体
  - `prev`: 前のパイプのファイルディスクリプタ配列
  - `pfd`: 現在のパイプのファイルディスクリプタ配列
- **処理**:
  1. 次のコマンドがある場合、`pipe` を作成する。失敗したらエラーを出力して `-1` を返す。
  2. `fork` で子プロセスを作成する。
  3. 子プロセスの場合:
     - `execute_child` を呼び出し、コマンドを実行する。
  4. 親プロセスの場合:
     - `handle_parent_pipeline` を呼び出し、パイプの管理を行う。
  5. プロセスIDを返す。

## 関数: execute_pipeline
- **引数**:
  - `cmds`: コマンドリスト
  - `data`: シェルの主要データ構造体
- **処理**:
  1. `prev_pipe` を `-1` で初期化する。
  2. `count_cmds` でコマンド数をカウントする。
  3. コマンドリストを走査するループ:
     - `process_pipeline_cmd` を呼び出し、コマンド処理とフォークを行う。
     - 返されたPIDを `last_pid` に保存する。
     - 次のコマンドへ進む。
  4. ループ終了後、残っている `prev_pipe` を閉じる。
  5. `wait_for_children` を呼び出し、すべての子プロセスの終了を待機する。
