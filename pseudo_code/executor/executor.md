# executor.c 疑似コード

## 関数: process_heredoc_redir
- **引数**:
  - `redir`: リダイレクト構造体
- **処理**:
  1. `create_heredoc` を呼び出し、ヒアドキュメントを作成する。
  2. 作成に失敗した場合、`-1` を返す。
  3. 元の `redir->file` (デリミタ) を解放し、作成されたファイル名に置き換える。
  4. `0` を返す。

## 関数: check_heredocs
- **引数**:
  - `cmds`: コマンドリスト
- **処理**:
  1. コマンドリストを走査する。
  2. 各コマンドのリダイレクトリストを走査する。
  3. `TOKEN_REDIR_HEREDOC` タイプのリダイレクトが見つかった場合:
     - `process_heredoc_redir` を呼び出す。
     - 失敗した場合、`-1` を返す。
  4. 全ての処理が成功した場合、`0` を返す。

## 関数: executor
- **引数**:
  - `cmds`: コマンドリスト
  - `data`: シェルの主要データ構造体
- **処理**:
  1. コマンドリストが空の場合、何もせず終了する。
  2. `check_heredocs` を呼び出し、ヒアドキュメントを事前に処理する。
     - 失敗した場合、処理を中断して戻る。
  3. `SIGINT` を無視 (`SIG_IGN`) するように設定する。
  4. 現在の標準入力と標準出力を `dup` で保存する (`saved_stdin`, `saved_stdout`)。
  5. コマンドが複数ある場合 (`cmds->next` が存在):
     - `execute_pipeline(cmds, data)` を呼び出す。
  6. コマンドが単一の場合:
     - `execute_cmd(cmds, data)` を呼び出す。
  7. 標準入力と標準出力を保存しておいたディスクリプタから復元する (`dup2`)。
  8. 保存用のディスクリプタを閉じる。
  9. `setup_signals` を呼び出し、シグナルハンドラを復元する。
