# heredoc.c 疑似コード

## 関数: get_heredoc_filename
- **引数**: なし
- **処理**:
  1. 静的変数 `i` を使用して、一意の番号を生成する。
  2. `/tmp/.heredoc_` と番号を結合してファイル名を作成する。
  3. 作成したファイル名を返す。

## 関数: read_heredoc_lines
- **引数**:
  - `fd`: 書き込み先のファイルディスクリプタ
  - `delimiter`: 終了判定用のデリミタ
- **処理**:
  1. 無限ループ:
     - `readline` でプロンプト `> ` を表示し、入力を読み取る。
     - 入力が `NULL` またはデリミタと一致する場合、ループを終了する。
     - 入力行をファイルに書き込む。
     - メモリを解放する。

## 関数: read_heredoc_child
- **引数**:
  - `fd`: 書き込み先のファイルディスクリプタ
  - `delimiter`: 終了判定用のデリミタ
- **処理**:
  1. `SIGINT` のハンドラを `signal_handler_heredoc` に設定する。
  2. `read_heredoc_lines` を呼び出し、入力を読み取る。
  3. ファイルディスクリプタを閉じる。
  4. `exit(0)` で終了する。

## 関数: handle_heredoc
- **引数**:
  - `delimiter`: ヒアドキュメントの終了識別子
- **処理**:
  1. `get_heredoc_filename` で一時ファイル名を取得する。
  2. ファイルを書き込みモード (`O_WRONLY | O_CREAT | O_TRUNC`) で開く。
     - 失敗した場合、ファイル名を解放して `-1` を返す。
  3. `fork` で子プロセスを作成する。
  4. 子プロセスの場合:
     - `read_heredoc_child` を呼び出す。
  5. 親プロセスの場合:
     - `SIGINT` を無視 (`SIG_IGN`) するように設定し、以前のハンドラを保存する。
     - `waitpid` で子プロセスの終了を待つ。
     - `SIGINT` のハンドラを元に戻す。
  6. ファイルディスクリプタを閉じる。
  7. 子プロセスがシグナル (`SIGINT`) で終了した場合 (ステータス 130):
     - 一時ファイルを削除し、メモリを解放して `-1` を返す。
  8. ファイルを読み込みモード (`O_RDONLY`) で開き直す。
  9. `unlink` でファイルを削除する。
  10. ファイル名を解放する。
  11. ファイルディスクリプタを返す。
