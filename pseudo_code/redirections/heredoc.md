# heredoc.c 疑似コード

## 関数: get_heredoc_filename
- **概要**:
  - ヒアドキュメント用の一意な一時ファイル名を生成する。
- **引数**: なし
- **処理**:
  1. 静的変数 `i` を使用して、一意の番号を生成する。
  2. `/tmp/.heredoc_` と番号を結合してファイル名を作成する。
  3. 作成したファイル名を返す。

## 関数: read_heredoc_lines
- **概要**:
  - 標準入力から行を読み取り、デリミタが現れるまでファイルに書き込む。
- **引数**:
  - `fd`: 書き込み先のファイルディスクリプタ
  - `delimiter`: 終了判定用のデリミタ
- **処理**:
  1. 無限ループ:
     - `readline` でプロンプト `> ` を表示し、入力を読み取る。
     - 入力が `NULL` またはデリミタと一致する場合、ループを終了する。
     - 入力行をファイルに書き込む。
     - メモリを解放する。

## 関数: read_heredoc_child
- **概要**:
  - 子プロセス内でヒアドキュメントの読み込みを実行し、終了処理を行う。
- **引数**:
  - `fd`: 書き込み先のファイルディスクリプタ
  - `delimiter`: 終了判定用のデリミタ
  - `data`: シェルの主要データ構造体
  - `filename`: 一時ファイル名
- **処理**:
  1. `SIGINT` のハンドラを `signal_handler_heredoc` に設定する。
  2. `read_heredoc_lines` を呼び出し、入力を読み取る。
  3. ファイルディスクリプタを閉じる。
  4. `filename` を解放する。
  5. `cleanup_data` を呼び出し、メモリを解放する。
  6. `g_signal_received` が `SIGINT` の場合、`exit(130)` する。
  7. それ以外の場合、`exit(0)` で終了する。

## 関数: wait_heredoc_child
- **概要**:
  - ヒアドキュメント読み込み用の子プロセスの終了を待機する。
- **引数**:
  - `pid`: 子プロセスのPID
- **戻り値**:
  - 中断された場合 (`SIGINT`) は `1`、それ以外は `0`
- **処理**:
  1. 親プロセスの `SIGINT` を一時的に無視 (`SIG_IGN`) する。
  2. `waitpid` で子プロセスの終了を待つ。
  3. `SIGINT` のハンドラを元に戻す。
  4. 子プロセスがステータス `130` で終了した場合、`1` を返す。
  5. それ以外の場合、`0` を返す。

## 関数: create_heredoc
- **概要**:
  - 子プロセスをフォークしてヒアドキュメントを作成し、親プロセスで待機する。
- **引数**:
  - `delimiter`: ヒアドキュメントの終了識別子
  - `filename_out`: 作成されたファイル名を格納するポインタ
  - `data`: シェルの主要データ構造体
- **処理**:
  1. `get_heredoc_filename` で一時ファイル名を取得する。
  2. ファイルを書き込みモード (`O_WRONLY | O_CREAT | O_TRUNC`) で開く。
     - 失敗した場合、ファイル名を解放して `-1` を返す。
  3. `fork` で子プロセスを作成する。
  4. 子プロセスの場合:
     - `read_heredoc_child` を呼び出す。
  5. 親プロセスの場合:
     - ファイルディスクリプタを閉じる。
     - `wait_heredoc_child` を呼び出し、子プロセスの終了を待つ。
     - 中断された場合 (`1` が返った場合):
       - 一時ファイルを削除 (`unlink`) する。
       - ファイル名を解放して `-1` を返す。
  6. 作成されたファイル名を `filename_out` に設定する。
  7. `0` を返す。
