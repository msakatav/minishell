# lexer.c 疑似コード

## 関数: is_separator
- **引数**:
  - `c`: 文字
- **処理**:
  1. 文字が空白、パイプ、リダイレクトのいずれかであれば真を返す。

## 関数: extract_part
- **引数**:
  - `input`: 入力文字列
  - `i`: 現在のインデックスへのポインタ
  - `quote_char`: クォート文字を格納するポインタ
- **処理**:
  1. `'` の場合: `handle_quotes` を呼び出し、`quote_char` に `'` を設定。
  2. `"` の場合: `handle_quotes` を呼び出し、`quote_char` に `"` を設定。
  3. その他: `handle_word` を呼び出し、`quote_char` に `0` を設定。
  4. 抽出した部分文字列を返す。

## 関数: append_part
- **引数**:
  - `result`: 結果文字列へのポインタ
  - `part`: 追加する部分文字列
- **処理**:
  1. `result` と `part` を結合し、新しい文字列を `result` に格納する。
  2. 古い `result` と `part` を解放する。

## 関数: protect_spaces
- **引数**:
  - `str`: 文字列
- **処理**:
  1. 文字列中の空白文字（スペース、タブ、改行など）を対応する特殊文字（ASCII 1-6）に置換する。

## 関数: process_part
- **引数**:
  - `part`: 部分文字列
  - `quote`: クォートタイプ
  - `data`: シェルの主要データ構造体
- **処理**:
  1. クォートがシングルクォートでない場合:
     - `expand_variables` で変数を展開する。
     - クォートがダブルクォートの場合、`protect_spaces` を呼び出して空白を保護する。
     - 元の `part` を解放し、展開後の文字列を返す。
  2. シングルクォートの場合:
     - `protect_spaces` を呼び出して空白を保護する。
     - そのまま返す。

## 関数: build_combined_word
- **引数**:
  - `input`: 入力文字列
  - `i`: 現在のインデックスへのポインタ
  - `quote_type`: クォートタイプを格納するポインタ
  - `data`: シェルの主要データ構造体
- **処理**:
  1. 結果文字列 `result` を空文字で初期化する。
  2. 区切り文字（`is_separator`）以外が続く間ループする:
     - `extract_part` で部分文字列を抽出する。
     - `process_part` で変数展開を行う。
     - クォートタイプを判定し、`has_unquoted` フラグや `quote_type` を更新する。
     - `append_part` で結果に結合する。
  3. `has_unquoted` が真なら `quote_type` を `0` に設定する。
  4. `result` を返す。

## 関数: restore_spaces
- **引数**:
  - `str`: 文字列
- **処理**:
  1. 文字列中の特殊文字（ASCII 1-6）を元の空白文字に戻す。

## 関数: add_split_tokens
- **引数**:
  - `tokens`: トークンリストへのポインタ
  - `value`: 分割対象の文字列
- **処理**:
  1. `value` を空白文字で分割する。
  2. 分割された各単語について、`restore_spaces` で空白を復元し、新しい `TOKEN_WORD` トークンを作成してリストに追加する。

## 関数: process_token
- **引数**:
  - `input`: 入力文字列
  - `i`: 現在のインデックスへのポインタ
  - `tokens`: トークンリストへのポインタ
  - `data`: シェルの主要データ構造体
- **処理**:
  1. `|` の場合: パイプトークンを追加し、インデックスを進める。
  2. `<` または `>` の場合: `handle_redirect` を呼び出す。
  3. その他の場合:
     - `build_combined_word` を呼び出し、単語を取得する。
     - 取得した単語が存在する場合:
       - 単語が空で、かつクォートされていた場合 (`quote_type != 0`):
         - 空文字のトークンを追加する。
       - 単語が空でない場合:
         - `add_split_tokens` を呼び出し、空白で分割してトークンを追加する。

## 関数: lexer
- **引数**:
  - `input`: 入力文字列
  - `data`: シェルの主要データ構造体
- **処理**:
  1. トークンリスト `tokens` を `NULL` に初期化する。
  2. 入力文字列の終わりまでループする:
     - 空白をスキップする。
     - 文字があれば `process_token` を呼び出し、トークンを生成・追加する。
  3. トークンリストを返す。
