# parser.c 疑似コード

## 関数: parse_command
- **引数**:
  - `tokens`: トークンリストへのポインタ
  - `data`: シェルの主要データ構造体
- **戻り値**:
  - 成功時: コマンド構造体
  - 失敗時: `NULL`
- **処理**:
  1. `new_cmd` で新しいコマンド構造体を作成する。
  2. 作成に失敗したら `NULL` を返す。
  3. トークンの開始位置を保存する。
  4. `parse_redirections` を呼び出し、リダイレクトを解析して格納する。
     - エラーが発生した場合 (`error` フラグがセットされた場合):
       - コマンド構造体を解放し、`NULL` を返す。
  5. トークン位置を元に戻す。
  6. `parse_args` を呼び出し、引数を解析して格納する。
  7. トークンポインタを更新する。
  8. コマンド構造体を返す。

## 関数: check_pipe_error
- **引数**:
  - `tokens`: 現在のトークン
  - `data`: シェルの主要データ構造体
- **戻り値**:
  - エラーあり: 1
  - エラーなし: 0
- **処理**:
  1. 現在のトークンがパイプ (`|`) の場合:
     - エラーメッセージ "minishell: syntax error near unexpected token `|'" を出力する。
     - 終了ステータスを 258 に設定する。
     - 1 を返す。
  2. 0 を返す。

## 関数: check_trailing_pipe
- **引数**:
  - `tokens`: トークンリストへのポインタ
  - `data`: シェルの主要データ構造体
- **戻り値**:
  - エラーあり: 1
  - エラーなし: 0
- **処理**:
  1. 現在のトークンが存在し、かつパイプ (`|`) の場合:
     - トークンを次に進める。
     - 次のトークンが存在しない場合 (行末のパイプ):
       - エラーメッセージ "minishell: syntax error: unexpected end of file" を出力する。
       - 終了ステータスを 258 に設定する。
       - 1 を返す。
  2. 0 を返す。

## 関数: process_token_group
- **引数**:
  - `tokens`: トークンリストへのポインタ
  - `cmds`: コマンドリストへのポインタ
  - `data`: シェルの主要データ構造体
- **戻り値**:
  - 成功: 0
  - 失敗: 1
- **処理**:
  1. `check_pipe_error` でパイプのエラーをチェックする。エラーなら 1 を返す。
  2. `parse_command` でコマンドを解析する。失敗なら 1 を返す。
  3. `add_cmd` で解析したコマンドをリストに追加する。
  4. `check_trailing_pipe` で末尾のパイプエラーをチェックする。エラーなら 1 を返す。
  5. 0 を返す。

## 関数: parser
- **引数**:
  - `tokens`: トークンリスト
  - `data`: シェルの主要データ構造体
- **戻り値**:
  - 成功時: コマンドリスト
  - 失敗時: `NULL`
- **処理**:
  1. コマンドリスト `cmds` を `NULL` に初期化する。
  2. トークンリストがある間ループする:
     - `process_token_group` を呼び出し、トークングループを処理する。
     - 処理に失敗した場合:
       - 作成済みのコマンドリストがあれば `free_cmds` で解放する。
       - `NULL` を返す。
  3. コマンドリストを返す。
